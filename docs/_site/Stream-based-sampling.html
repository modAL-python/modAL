<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Stream-based sampling &middot; modAL
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="public/css/poole.css">
  <link rel="stylesheet" href="public/css/syntax.css">
  <link rel="stylesheet" href="public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="index">
          modAL
        </a>
      </h1>
      <p class="lead">A modular active learning framework for Python3</p>
    </div>

    <nav class="sidebar-nav">
      <b>Overview</b>
        <a class="sidebar-nav-item" href="index">modAL in a nutshell</a>
        <a class="sidebar-nav-item" href="Installation">Installation</a>
      <b>Models</b>
        <a class="sidebar-nav-item" href="ActiveLearner">ActiveLearner</a>
        <a class="sidebar-nav-item" href="Committee">Committee</a>
      <b>Query strategies</b>
        <a class="sidebar-nav-item" href="Uncertainty-sampling">Uncertainty sampling</a>
        <a class="sidebar-nav-item" href="Disagreement-sampling">Disagreement sampling</a>
        <a class="sidebar-nav-item" href="Extending-modAL">Extending modAL</a>
      <b>Examples</b>
        <a class="sidebar-nav-item" href="Pool-based-sampling">Pool-based sampling</a>
        <a class="sidebar-nav-item" href="Stream-based-sampling">Stream-based sampling</a>
        <a class="sidebar-nav-item" href="Active-regression">Active regression</a>
        <a class="sidebar-nav-item" href="Query-by-committee">Query by committee</a>
        <a class="sidebar-nav-item" href="Bootstrapping-and-bagging">Bootstrapping and bagging</a>
        <a class="sidebar-nav-item" href="Keras-integration">Keras integration</a>
      <b>API reference</b>
        <a class="sidebar-nav-item" href="Models-API">modAL.models</a>
        <a class="sidebar-nav-item" href="Uncertainty-sampling-API">modAL.uncertainty</a>
        <a class="sidebar-nav-item" href="Disagreement-sampling-API">modAL.disagreement</a>
    </nav>

    <p>&copy; <a href="https://github.com/poole/hyde">Theme</a> by Mark Otto</p>
  </div>
</div>


    <div class="content container">
      <div class="page">
  <h1 id="stream-based-sampling">Stream-based sampling</h1>
<p>In addition to pool-based sampling, the stream-based scenario can also be implemented easily with modAL. In this case, the labels are not queried from a pool of instances. Rather, they are given one-by-one for the learner, which queries for its label if it finds the example useful. For instance, an example can be marked as useful if the prediction is uncertain, because acquiring its label would remove this uncertainty.</p>

<p>The executable script for this example can be <a href="https://github.com/cosmic-cortex/modAL/blob/master/examples/stream-based_sampling.py">found here!</a></p>

<h2 id="the-dataset">The dataset</h2>
<p>In this example, we are going to learn a black square on a white background. We are going to use a random forest classifier in a stream-based setting. First, let’s generate some data!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># creating the image</span>
<span class="n">im_width</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">im_height</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">im_height</span><span class="p">,</span> <span class="n">im_width</span><span class="p">))</span>
<span class="n">im</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="n">im_width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">:</span><span class="n">im_height</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c"># create the data to stream from</span>
<span class="n">X_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
     <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
<span class="p">)</span>
<span class="c"># map the intensity values against the grid</span>
<span class="n">y_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">im</span><span class="p">[</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">X_full</span><span class="p">])</span>
</code></pre></div></div>

<p>In case you are wondering, here is how this looks like!
<img src="/img/sbs-data.png" alt="sbs-data" /></p>

<h2 id="active-learning">Active learning</h2>
<p>Initializing the learner is the same as always.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="c"># assembling initial training set</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">n_initial</span> <span class="o">=</span> <span class="mi">5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">initial_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_full</span><span class="p">)),</span> <span class="n">size</span><span class="o">=</span><span class="n">n_initial</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">X_full</span><span class="p">[</span><span class="n">initial_idx</span><span class="p">],</span> <span class="n">y_full</span><span class="p">[</span><span class="n">initial_idx</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="c"># initialize the learner</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">learner</span> <span class="o">=</span> <span class="n">ActiveLearner</span><span class="p">(</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">predictor</span><span class="o">=</span><span class="n">RandomForestClassifier</span><span class="p">(),</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">X_initial</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_initial</span><span class="o">=</span><span class="n">y_train</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">'Initial prediction accuracy: </span><span class="si">%</span><span class="s">f'</span> <span class="o">%</span> <span class="n">learner</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_full</span><span class="p">,</span> <span class="n">y_full</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">...</span> <span class="n">Initial</span> <span class="n">prediction</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mf">0.410244</span>
</code></pre></div></div>
<p>This is how the class prediction probabilities look like for each pixel.
<img src="/img/sbs-initial.png" alt="sbs-initial" /></p>

<p>Now we are going to randomly sample pixels from the image. If the prediction of the pixel’s value is uncertain, we query the true value and teach it to the classifier. We are going to do this until we reach at least 90% accuracy.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="c"># learning until the accuracy reaches a given threshold</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">while</span> <span class="n">learner</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_full</span><span class="p">,</span> <span class="n">y_full</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.90</span><span class="p">:</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">stream_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_full</span><span class="p">)))</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="k">if</span> <span class="n">classifier_uncertainty</span><span class="p">(</span><span class="n">learner</span><span class="p">,</span> <span class="n">X_full</span><span class="p">[</span><span class="n">stream_idx</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mf">0.4</span><span class="p">:</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="n">learner</span><span class="o">.</span><span class="n">teach</span><span class="p">(</span><span class="n">X_full</span><span class="p">[</span><span class="n">stream_idx</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">y_full</span><span class="p">[</span><span class="n">stream_idx</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span>         <span class="k">print</span><span class="p">(</span><span class="s">'Pixel no. </span><span class="si">%</span><span class="s">d queried, new accuracy: </span><span class="si">%</span><span class="s">f'</span> <span class="o">%</span> <span class="p">(</span><span class="n">stream_idx</span><span class="p">,</span> <span class="n">learner</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_full</span><span class="p">,</span> <span class="n">y_full</span><span class="p">)))</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">...</span> <span class="n">Pixel</span> <span class="n">no</span><span class="o">.</span> <span class="mi">83428</span> <span class="n">queried</span><span class="p">,</span> <span class="n">new</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mf">0.551316</span>
<span class="o">...</span> <span class="n">Pixel</span> <span class="n">no</span><span class="o">.</span> <span class="mi">170935</span> <span class="n">queried</span><span class="p">,</span> <span class="n">new</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mf">0.491884</span>
<span class="o">...</span> <span class="n">Pixel</span> <span class="n">no</span><span class="o">.</span> <span class="mi">159529</span> <span class="n">queried</span><span class="p">,</span> <span class="n">new</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mf">0.570128</span>
<span class="o">...</span> <span class="n">Pixel</span> <span class="n">no</span><span class="o">.</span> <span class="mi">170628</span> <span class="n">queried</span><span class="p">,</span> <span class="n">new</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mf">0.735812</span>
<span class="o">...</span> <span class="n">Pixel</span> <span class="n">no</span><span class="o">.</span> <span class="mi">41672</span> <span class="n">queried</span><span class="p">,</span> <span class="n">new</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mf">0.785508</span>
<span class="o">...</span> <span class="n">Pixel</span> <span class="n">no</span><span class="o">.</span> <span class="mi">158656</span> <span class="n">queried</span><span class="p">,</span> <span class="n">new</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mf">0.703844</span>
<span class="o">...</span> <span class="n">Pixel</span> <span class="n">no</span><span class="o">.</span> <span class="mi">170505</span> <span class="n">queried</span><span class="p">,</span> <span class="n">new</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mf">0.737596</span>
<span class="o">...</span> <span class="n">Pixel</span> <span class="n">no</span><span class="o">.</span> <span class="mi">248886</span> <span class="n">queried</span><span class="p">,</span> <span class="n">new</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mf">0.741332</span>
<span class="o">...</span> <span class="n">Pixel</span> <span class="n">no</span><span class="o">.</span> <span class="mi">219077</span> <span class="n">queried</span><span class="p">,</span> <span class="n">new</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mf">0.810620</span>
<span class="o">...</span> <span class="n">Pixel</span> <span class="n">no</span><span class="o">.</span> <span class="mi">181856</span> <span class="n">queried</span><span class="p">,</span> <span class="n">new</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mf">0.820960</span>
<span class="o">...</span> <span class="n">Pixel</span> <span class="n">no</span><span class="o">.</span> <span class="mi">215676</span> <span class="n">queried</span><span class="p">,</span> <span class="n">new</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mf">0.850944</span>
<span class="o">...</span> <span class="n">Pixel</span> <span class="n">no</span><span class="o">.</span> <span class="mi">65082</span> <span class="n">queried</span><span class="p">,</span> <span class="n">new</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mf">0.818608</span>
<span class="o">...</span> <span class="n">Pixel</span> <span class="n">no</span><span class="o">.</span> <span class="mi">116893</span> <span class="n">queried</span><span class="p">,</span> <span class="n">new</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mf">0.860196</span>
<span class="o">...</span> <span class="n">Pixel</span> <span class="n">no</span><span class="o">.</span> <span class="mi">33343</span> <span class="n">queried</span><span class="p">,</span> <span class="n">new</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mf">0.809160</span>
<span class="o">...</span> <span class="n">Pixel</span> <span class="n">no</span><span class="o">.</span> <span class="mi">82664</span> <span class="n">queried</span><span class="p">,</span> <span class="n">new</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mf">0.901644</span>
</code></pre></div></div>
<p>As you can see, prediction accuracy can deteriorate after a query, but on the long run, it should get better. (Though this is not always the case with uncertainty-based sampling.) Here are the prediction probabilities after a few queries:
<img src="/img/sbs-final.png" alt="sbs-final" /></p>

</div>

    </div>

  </body>
</html>
